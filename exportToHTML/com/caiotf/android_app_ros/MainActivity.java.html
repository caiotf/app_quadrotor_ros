<html>
<head>
<title>MainActivity.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #999999; font-weight: normal; font-style: normal; }
.s0 { color: rgb(0,0,128); font-weight: bold; }
.s1 { color: rgb(0,0,0); }
.s2 { color: rgb(0,128,0); font-weight: bold; }
.s3 { color: rgb(0,0,255); }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
MainActivity.java</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">package </span><span class="s1">com.caiotf.android_app_ros; 
 
</span><span class="s0">import </span><span class="s1">android.os.Build; 
</span><span class="s0">import </span><span class="s1">android.os.Bundle; 
</span><span class="s0">import </span><span class="s1">android.support.constraint.ConstraintLayout; 
</span><span class="s0">import </span><span class="s1">android.view.View; 
</span><span class="s0">import </span><span class="s1">android.widget.LinearLayout; 
</span><span class="s0">import </span><span class="s1">android.widget.Toast; 
</span><span class="s0">import </span><span class="s1">android.widget.ToggleButton; 
 
</span><span class="s0">import </span><span class="s1">com.google.common.base.Preconditions; 
</span><span class="s0">import </span><span class="s1">com.google.common.collect.Lists; 
 
</span><span class="s0">import </span><span class="s1">org.ros.address.InetAddressFactory; 
</span><span class="s0">import </span><span class="s1">org.ros.android.BitmapFromCompressedImage; 
</span><span class="s0">import </span><span class="s1">org.ros.android.RosActivity; 
</span><span class="s0">import </span><span class="s1">org.ros.android.view.RosImageView; 
</span><span class="s0">import </span><span class="s1">org.ros.android.view.visualization.VisualizationView; 
</span><span class="s0">import </span><span class="s1">org.ros.android.view.visualization.layer.CameraControlLayer; 
</span><span class="s0">import </span><span class="s1">org.ros.android.view.visualization.layer.CameraControlListener; 
</span><span class="s0">import </span><span class="s1">org.ros.android.view.visualization.layer.LaserScanLayer; 
</span><span class="s0">import </span><span class="s1">org.ros.android.view.visualization.layer.Layer; 
</span><span class="s0">import </span><span class="s1">org.ros.android.view.visualization.layer.OccupancyGridLayer; 
</span><span class="s0">import </span><span class="s1">org.ros.android.view.visualization.layer.RobotLayer; 
</span><span class="s0">import </span><span class="s1">org.ros.node.NodeConfiguration; 
</span><span class="s0">import </span><span class="s1">org.ros.node.NodeMainExecutor; 
 
</span><span class="s0">import </span><span class="s1">sensor_msgs.CompressedImage; 
 
</span><span class="s0">public class </span><span class="s1">MainActivity </span><span class="s0">extends </span><span class="s1">RosActivity { 
    </span><span class="s0">private int </span><span class="s1">currentApiVersion; 
    </span><span class="s0">private </span><span class="s1">RosImageView&lt;CompressedImage&gt; rosImageView; 
 
    </span><span class="s0">private static final </span><span class="s1">String MAP_FRAME = </span><span class="s2">&quot;map&quot;</span><span class="s1">; 
    </span><span class="s0">private static final </span><span class="s1">String ROBOT_FRAME = </span><span class="s2">&quot;base_link&quot;</span><span class="s1">; 
 
    </span><span class="s0">private final </span><span class="s1">SystemCommands systemCommands; 
 
    </span><span class="s0">private </span><span class="s1">VisualizationView visualizationView; 
    </span><span class="s0">private </span><span class="s1">ToggleButton followMeToggleButton; 
    </span><span class="s0">private </span><span class="s1">CameraControlLayer cameraControlLayer; 
 
    </span><span class="s0">private </span><span class="s1">ConstraintLayout constraintMap; 
    </span><span class="s0">private </span><span class="s1">LinearLayout linearLayoutMap; 
 
    </span><span class="s0">public </span><span class="s1">MainActivity() { 
        </span><span class="s0">super</span><span class="s1">(</span><span class="s2">&quot;Controle&quot;</span><span class="s1">, </span><span class="s2">&quot;Controle&quot;</span><span class="s1">); 
        systemCommands = </span><span class="s0">new </span><span class="s1">SystemCommands(); 
    } 
 
    @Override 
    </span><span class="s0">protected void </span><span class="s1">onCreate(Bundle savedInstanceState) { 
        </span><span class="s0">super</span><span class="s1">.onCreate(savedInstanceState); 
        setContentView(R.layout.activity_main); 
 
        currentApiVersion = android.os.Build.VERSION.SDK_INT; 
        </span><span class="s0">final int </span><span class="s1">flags = View.SYSTEM_UI_FLAG_LAYOUT_STABLE 
                | View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION 
                | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN 
                | View.SYSTEM_UI_FLAG_HIDE_NAVIGATION 
                | View.SYSTEM_UI_FLAG_FULLSCREEN 
                | View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY; 
 
        </span><span class="s0">if </span><span class="s1">(currentApiVersion &gt;= Build.VERSION_CODES.KITKAT) { 
            getWindow().getDecorView().setSystemUiVisibility(flags); 
            </span><span class="s0">final </span><span class="s1">View decorView = getWindow().getDecorView(); 
            decorView.setOnSystemUiVisibilityChangeListener(</span><span class="s0">new </span><span class="s1">View.OnSystemUiVisibilityChangeListener() { 
                @Override 
                </span><span class="s0">public void </span><span class="s1">onSystemUiVisibilityChange(</span><span class="s0">int </span><span class="s1">visibility) { 
                    </span><span class="s0">if </span><span class="s1">((visibility &amp; View.SYSTEM_UI_FLAG_FULLSCREEN) == </span><span class="s3">0</span><span class="s1">) { 
                        decorView.setSystemUiVisibility(flags); 
                    } 
                } 
            }); 
        } 
 
        rosImageView = findViewById(R.id.image); 
        rosImageView.setTopicName(</span><span class="s2">&quot;/front_cam/camera/image/compressed&quot;</span><span class="s1">); 
        rosImageView.setMessageType(</span><span class="s2">&quot;sensor_msgs/CompressedImage&quot;</span><span class="s1">); 
        rosImageView.setMessageToBitmapCallable(</span><span class="s0">new </span><span class="s1">BitmapFromCompressedImage()); 
 
        constraintMap = findViewById(R.id.constraintMapId); 
        linearLayoutMap = findViewById(R.id.linearMapId); 
 
        visualizationView = findViewById(R.id.visualization); 
        cameraControlLayer = </span><span class="s0">new </span><span class="s1">CameraControlLayer(); 
        visualizationView.onCreate(Lists.&lt;Layer&gt;newArrayList(cameraControlLayer, 
                </span><span class="s0">new </span><span class="s1">OccupancyGridLayer(</span><span class="s2">&quot;map&quot;</span><span class="s1">), </span><span class="s0">new </span><span class="s1">LaserScanLayer(</span><span class="s2">&quot;scan&quot;</span><span class="s1">), </span><span class="s0">new </span><span class="s1">RobotLayer(ROBOT_FRAME))); 
        followMeToggleButton = findViewById(R.id.follow_me_toggle_button); 
        enableFollowMe(); 
 
    } 
 
    @Override 
    </span><span class="s0">protected void </span><span class="s1">init(NodeMainExecutor nodeMainExecutor) { 
 
        NodeControle nodeControle = </span><span class="s0">new </span><span class="s1">NodeControle(</span><span class="s0">this</span><span class="s1">); 
 
        NodeConfiguration nodeConfiguration = NodeConfiguration.newPublic(InetAddressFactory.newNonLoopback().getHostAddress(), getMasterUri()); 
 
        nodeMainExecutor.execute(nodeControle, nodeConfiguration); 
        nodeMainExecutor.execute(rosImageView, nodeConfiguration); 
 
        visualizationView.init(nodeMainExecutor); 
        cameraControlLayer.addListener(</span><span class="s0">new </span><span class="s1">CameraControlListener() { 
            @Override 
            </span><span class="s0">public void </span><span class="s1">onZoom(</span><span class="s0">float </span><span class="s1">focusX, </span><span class="s0">float </span><span class="s1">focusY, </span><span class="s0">float </span><span class="s1">factor) { 
                disableFollowMe(); 
            } 
 
            @Override 
            </span><span class="s0">public void </span><span class="s1">onTranslate(</span><span class="s0">float </span><span class="s1">distanceX, </span><span class="s0">float </span><span class="s1">distanceY) { 
                disableFollowMe(); 
            } 
 
            @Override 
            </span><span class="s0">public void </span><span class="s1">onRotate(</span><span class="s0">float </span><span class="s1">focusX, </span><span class="s0">float </span><span class="s1">focusY, </span><span class="s0">double </span><span class="s1">deltaAngle) { 
                disableFollowMe(); 
            } 
 
            @Override 
            </span><span class="s0">public void </span><span class="s1">onDoubleTap(</span><span class="s0">float </span><span class="s1">x, </span><span class="s0">float </span><span class="s1">y) { 
            } 
        }); 
 
        nodeMainExecutor.execute(visualizationView, nodeConfiguration); 
        nodeMainExecutor.execute(systemCommands, nodeConfiguration); 
 
    } 
 
    </span><span class="s0">public void </span><span class="s1">onClearMapButtonClicked(View view) { 
        toast(</span><span class="s2">&quot;Limpando mapa...&quot;</span><span class="s1">); 
        systemCommands.reset(); 
        enableFollowMe(); 
    } 
 
    </span><span class="s0">public void </span><span class="s1">onSaveMapButtonClicked(View view) { 
        toast(</span><span class="s2">&quot;Salvando mapa...&quot;</span><span class="s1">); 
        systemCommands.saveGeotiff(); 
    } 
 
    </span><span class="s0">private void </span><span class="s1">toast(</span><span class="s0">final </span><span class="s1">String text) { 
        runOnUiThread(</span><span class="s0">new </span><span class="s1">Runnable() { 
            @Override 
            </span><span class="s0">public void </span><span class="s1">run() { 
                Toast toast = Toast.makeText(MainActivity.</span><span class="s0">this</span><span class="s1">, text, Toast.LENGTH_SHORT); 
                toast.show(); 
            } 
        }); 
    } 
 
    </span><span class="s0">public void </span><span class="s1">onFollowMeToggleButtonClicked(View view) { 
        </span><span class="s0">boolean </span><span class="s1">on = ((ToggleButton) view).isChecked(); 
        </span><span class="s0">if </span><span class="s1">(on) { 
            enableFollowMe(); 
        } </span><span class="s0">else </span><span class="s1">{ 
            disableFollowMe(); 
        } 
    } 
 
    </span><span class="s0">private void </span><span class="s1">enableFollowMe() { 
        Preconditions.checkNotNull(visualizationView); 
        Preconditions.checkNotNull(followMeToggleButton); 
        runOnUiThread(</span><span class="s0">new </span><span class="s1">Runnable() { 
            @Override 
            </span><span class="s0">public void </span><span class="s1">run() { 
                visualizationView.getCamera().jumpToFrame(ROBOT_FRAME); 
                followMeToggleButton.setChecked(</span><span class="s0">true</span><span class="s1">); 
            } 
        }); 
    } 
 
    </span><span class="s0">private void </span><span class="s1">disableFollowMe() { 
        Preconditions.checkNotNull(visualizationView); 
        Preconditions.checkNotNull(followMeToggleButton); 
        runOnUiThread(</span><span class="s0">new </span><span class="s1">Runnable() { 
            @Override 
            </span><span class="s0">public void </span><span class="s1">run() { 
                visualizationView.getCamera().setFrame(MAP_FRAME); 
                followMeToggleButton.setChecked(</span><span class="s0">false</span><span class="s1">); 
            } 
        }); 
    } 
 
    </span><span class="s0">public void </span><span class="s1">onMapButtonClicked(View view) { 
        </span><span class="s0">boolean </span><span class="s1">on = ((ToggleButton) view).isChecked(); 
        </span><span class="s0">if </span><span class="s1">(on) { 
            constraintMap.setVisibility(View.VISIBLE); 
            linearLayoutMap.setVisibility(View.VISIBLE); 
        } </span><span class="s0">else </span><span class="s1">{ 
            constraintMap.setVisibility(View.GONE); 
            linearLayoutMap.setVisibility(View.GONE); 
        } 
    } 
     
} 
</span></pre>
</body>
</html>